}
CourseTypeTemp <- ii %>%
html() %>%
html_nodes('.value div:nth-child(1)') %>%
html_text
CourseType[jj] <- CourseTypeTemp[1]
Department[jj] <- ii %>%
html() %>%
html_nodes('.SubTableLevel2 tr:nth-child(1) .page+ td') %>%
html_text
res2<-try(SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text,silent=TRUE)
if (inherits(res2,'try-error')){
SecondaryDepartment[jj] <- 'No'
}else{
SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text
}
AverageGrade[jj] <- GradeLinks2[jj] %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) td+ td') %>%
html_text
#for (kk in TempHist){
#}
jj<-jj+1
}
rownames(df)<-categories
df$ECTS <- ECTS
df$CourseType <- CourseType
df$Department <- gsub('[\r\n]','',Department)
df$SecondaryDepartment <- gsub('[\r\n]','',SecondaryDepartment)
AverageGradeTemp <- gsub('[\r\n (Efter7 trinsskalaen) ]','',AverageGrade)
df$AverageGrade <- gsub('-','',AverageGrade)
df
df[1]
df[2]
df[3]
df[4]
df[5]
df$AverageGrade <- gsub('-','',AverageGradeTemp)
df[5]
require(rvest)
## Fall semester
url<- 'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E&YearGroup=2014-2015,2015-2016&btnSearch=Search'
categories <- url %>%
html() %>%
html_nodes('#ctl00_PlaceHolderMain_PageHtml td div a') %>%
html_text()
categories<-unique(categories[200:210])
departments <- url %>%
html() %>%
html_nodes('#lstDepartment option') %>%
html_text()
#Initialazing the data frame
Period <- 'Winter-2014'
df <- data.frame(matrix(nrow=length(categories),ncol=0))
CourseNum <- substring(categories,1,5)
GeneralLinks <- paste('http://www.kurser.dtu.dk/',CourseNum,'.aspx?menulanguage=en-gb',sep='')
GradeLinks <- paste('http://www.kurser.dtu.dk/courses/',CourseNum,'/info/default.aspx',sep='')
GradeLinks2 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum,'/',Period,sep='')
jj <- 1
CourseType <- rep(0,length(GeneralLinks))
ECTS <- rep(0,length(GeneralLinks))
Department <- rep(0,length(GeneralLinks))
SecondaryDepartment <- rep(0,length(GeneralLinks))
AverageGrade <- rep(0,length(GeneralLinks))
#TempHist <- rep(0,c(100,100))
for (ii in GeneralLinks){
res<-try(ECTS[jj]<-ii %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) .value') %>%
html_text,silent=TRUE)
if (inherits(res,'try-error')){
ECTS[jj]<-ii %>%
html() %>%
html_nodes('.normal+ table tr:nth-child(4) .value') %>%
html_text
}else{
ECTS[jj]<-ii %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) .value') %>%
html_text
}
CourseTypeTemp <- ii %>%
html() %>%
html_nodes('.value div:nth-child(1)') %>%
html_text
CourseType[jj] <- CourseTypeTemp[1]
Department[jj] <- ii %>%
html() %>%
html_nodes('.SubTableLevel2 tr:nth-child(1) .page+ td') %>%
html_text
res2<-try(SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text,silent=TRUE)
if (inherits(res2,'try-error')){
SecondaryDepartment[jj] <- 'No'
}else{
SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text
}
AverageGrade[jj] <- GradeLinks2[jj] %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) td+ td') %>%
html_text
#for (kk in TempHist){
#}
jj<-jj+1
}
rownames(df)<-categories
df$ECTS <- ECTS
df$CourseType <- CourseType
df$Department <- gsub('[\r\n]','',Department)
df$SecondaryDepartment <- gsub('[\r\n]','',SecondaryDepartment)
AverageGradeTemp <- gsub('[\r\n (Efter7 trinsskalaen) ]','',AverageGrade)
df$AverageGrade <- gsub('-','',AverageGradeTemp)
df[1]
df[2]
df[3]
df[4]
df[5]
df[6]
df[5]
as.numeric(df[5])
as.list(df[5])
a<-as.list(df[5])
a
a[1]
a[[1]]
as.numeric(a[[1]])
lol <- gsub('[\r\n (Efter7 trinsskalaen) ]','',AverageGrade)
lol
lol2<-gsub('-','',lol)
lol2
lol3 <- gsub(',','.',lol2)
lol3
as.numeric(lol3)
rm(list=ls())
require(rvest)
url<- 'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E&YearGroup=2014-2015,2015-2016&btnSearch=Search'
categories <- url %>%
html() %>%
html_nodes('#ctl00_PlaceHolderMain_PageHtml td div a') %>%
html_text()
categories<-unique(categories[200:210])
departments <- url %>%
html() %>%
html_nodes('#lstDepartment option') %>%
html_text()
categories
rm(list=ls())
require(rvest)
## Fall semester
url<- 'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E&YearGroup=2014-2015,2015-2016&btnSearch=Search'
categories <- url %>%
html() %>%
html_nodes('#ctl00_PlaceHolderMain_PageHtml td div a') %>%
html_text()
categories<-unique(categories[200:210])
departments <- url %>%
html() %>%
html_nodes('#lstDepartment option') %>%
html_text()
#Initialazing the data frame
Period <- 'Winter-2014'
df <- data.frame(matrix(nrow=length(categories),ncol=0))
CourseNum <- substring(categories,1,5)
GeneralLinks <- paste('http://www.kurser.dtu.dk/',CourseNum,'.aspx?menulanguage=en-gb',sep='')
GradeLinks <- paste('http://www.kurser.dtu.dk/courses/',CourseNum,'/info/default.aspx',sep='')
GradeLinks2 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum,'/',Period,sep='')
jj <- 1
CourseType <- rep(0,length(GeneralLinks))
ECTS <- rep(0,length(GeneralLinks))
Department <- rep(0,length(GeneralLinks))
SecondaryDepartment <- rep(0,length(GeneralLinks))
AverageGrade <- rep(0,length(GeneralLinks))
#TempHist <- rep(0,c(100,100))
for (ii in GeneralLinks){
res<-try(ECTS[jj]<-ii %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) .value') %>%
html_text,silent=TRUE)
if (inherits(res,'try-error')){
ECTS[jj]<-ii %>%
html() %>%
html_nodes('.normal+ table tr:nth-child(4) .value') %>%
html_text
}else{
ECTS[jj]<-ii %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) .value') %>%
html_text
}
CourseTypeTemp <- ii %>%
html() %>%
html_nodes('.value div:nth-child(1)') %>%
html_text
CourseType[jj] <- CourseTypeTemp[1]
Department[jj] <- ii %>%
html() %>%
html_nodes('.SubTableLevel2 tr:nth-child(1) .page+ td') %>%
html_text
res2<-try(SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text,silent=TRUE)
if (inherits(res2,'try-error')){
SecondaryDepartment[jj] <- 'No'
}else{
SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text
}
AverageGrade[jj] <- GradeLinks2[jj] %>%
html() %>%
html_nodes('h2+ table tr:nth-child(4) td+ td') %>%
html_text
#for (kk in TempHist){
res3<-try(SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text,silent=TRUE)
if (inherits(res3,'try-error')){
SecondaryDepartment[jj] <- 'No'
}else{
SecondaryDepartment[jj]<-ii %>%
html() %>%
html_nodes('#pagecontents tr:nth-child(2) div') %>%
html_text
}
#}
jj<-jj+1
}
rownames(df)<-categories
df$ECTS <- ECTS
df$CourseType <- CourseType
df$Department <- gsub('[\r\n]','',Department)
df$SecondaryDepartment <- gsub('[\r\n]','',SecondaryDepartment)
AverageGradeTemp <- gsub('[\r\n (Efter7 trinsskalaen) ]','',AverageGrade)
AverageGradeTemp <- gsub(',','.',AverageGradeTemp)
df$AverageGrade <- gsub('-','',AverageGradeTemp)
rm(list=ls())
require(rvest)
## Fall semester
url<- 'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E&YearGroup=2014-2015,2015-2016&btnSearch=Search'
categories <- url %>%
html() %>%
html_nodes('#ctl00_PlaceHolderMain_PageHtml td div a') %>%
html_text()
categories<-unique(categories[200:210])
departments <- url %>%
html() %>%
html_nodes('#lstDepartment option') %>%
html_text()
#Initialazing the data frame
rm(list=ls())
require(rvest)
## Fall semester
url<- 'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E&YearGroup=2014-2015,2015-2016&btnSearch=Search'
categories <- url %>%
html() %>%
html_nodes('#ctl00_PlaceHolderMain_PageHtml td div a') %>%
html_text()
categories<-unique(categories[200:210])
departments <- url %>%
html() %>%
html_nodes('#lstDepartment option') %>%
html_text()
rm(list=ls())
require(rvest)
url<- 'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E&YearGroup=2014-2015,2015-2016&btnSearch=Search'
categories <- url %>%
html() %>%
html_nodes('#ctl00_PlaceHolderMain_PageHtml td div a') %>%
html_text()
categories<-unique(categories[200:210])
departments <- url %>%
html() %>%
html_nodes('#lstDepartment option') %>%
html_text()
rm(list=ls())
setwd('C:/Users/Dimitrios/Documents/Dimitris_general/R programming my projects/DTUprject')
load('lol')
load('lol2')
url2 <-'http://www.kurser.dtu.dk/search.aspx?lstTeachingPeriod=E1;E2;E3;E4;E5;E1A;E2A;E3A;E4A;E5A;E1B;E2B;E3B;E4B;E5B;E,E1;E1A;E1B,E2;E2A;E2B,E3;E3A;E3B,E4;E4A;E4B,E5;E5A;E5B,F1;F2;F3;F4;F5;F1A;F2A;F3A;F4A;F5A;F1B;F2B;F3B;F4B;F5B;F,F1;F1A;F1B,F2;F2A;F2B,F3;F3A;F3B,F4;F4A;F4B,F5;F5A;F5B,January,August;July;SummerSchool;June,August,July,June,SummerSchool&YearGroup=2014-2015,2015-2016&btnSearch=Search'
state_GetGradeTable <- 'td tr+ tr td:nth-child(2)'
#state_Attendants <- 'h2+ table td+ td'
state_Attendants <-'h2+ table tr:nth-child(4) td+ td , h2+ table tr:nth-child(3) td+ td , h2+ table tr:nth-child(2) td+ td , h2+ table tr:nth-child(1) td+ td'
## Get courses
categories<-GetUrlData(urlPath=url2,state=state_GetCourse)
categories<-unique(categories)
source('GetUrlData.R')
categories<-GetUrlData(urlPath=url2,state=state_GetCourse)
categories<-unique(categories)
categories<-GetUrlData(urlPath=url2,state=state_GetCourse)
require(rvest)
categories<-GetUrlData(urlPath=url2,state=state_GetCourse)
categories<-unique(categories)
categories
categories<-GetUrlData(urlPath=url2,state=state_GetCourse)
state_GetCourse<-'#ctl00_PlaceHolderMain_PageHtml td div a'
state_GetDepartments <- '#lstDepartment option'
state_GetECTS <- 'h2+ table tr:nth-child(4) .value'
state_GetECTS2 <- '.normal+ table tr:nth-child(4) .value'
state_CourseTypr <- '.value div:nth-child(1)'
state_CourseTypr2 <-'.normal+ table tr:nth-child(5) .value'
state_GetDepartment <- '.SubTableLevel2 tr:nth-child(1) .page+ td'
state_GetDepartmentSecondary <- 'tr:nth-child(2) div'
#second page(information)
state_PeriodNumber <- 'span td+ td'
##Third page
state_GetGradeTable <- 'td tr+ tr td:nth-child(2)'
#state_Attendants <- 'h2+ table td+ td'
state_Attendants <-'h2+ table tr:nth-child(4) td+ td , h2+ table tr:nth-child(3) td+ td , h2+ table tr:nth-child(2) td+ td , h2+ table tr:nth-child(1) td+ td'
categories<-GetUrlData(urlPath=url2,state=state_GetCourse)
categories<-unique(categories)
CourseNum <- substring(categories,1,5)
CourseInfoLinks <- paste('http://www.kurser.dtu.dk/',CourseNum,'.aspx?menulanguage=en-gb',sep='')
GradeLinks <- paste('http://www.kurser.dtu.dk/courses/',CourseNum,'/info/default.aspx',sep='')
NumberListCourse
TotalData <- list()
DATA<-list()
for (ii in CourseInfoLinks[1]){
if (url.exists(ii)){
#get ECTS credits
res<-try(ECTS[jj]<-GetUrlData(urlPath=ii,state_GetECTS),silent=TRUE)
resB<-try(ECTS[jj]<-GetUrlData(urlPath=ii,state_GetECTS2),silent=TRUE)
if (inherits(res,'try-error')){
ECTS[jj]<- GetUrlData(urlPath=ii,state_GetECTS2)
}else if(inherits(resB,'try-error')){
ECTS[jj]<-GetUrlData(urlPath=ii,state_GetECTS)
}else{
ECTS[jj]<-NA
}
#get CourseType credits
res2 <- try(CourseType[jj]<-GetUrlData(urlPath=ii,state_CourseTypr),silent=TRUE)
if (inherits(res2,'try-error')){
CourseType[jj] <- NA
}else{
CourseTypeTemp <- GetUrlData(urlPath=ii,state_CourseTypr)
CourseType[jj] <- CourseTypeTemp[1]
}
# get Deparment and secondary
res3 <- try(Department[jj]<-GetUrlData(urlPath=ii,state_GetDepartment),silent=TRUE)
if (inherits(res3,'try-error')){
Department[jj] <- NA
}else{
Department[jj] <- GetUrlData(urlPath=ii,state_GetDepartment)
}
res4<-try(SecondaryDepartment[jj]<-GetUrlData(urlPath=ii,state_GetDepartmentSecondary),silent=TRUE)
if (inherits(res4,'try-error')){
SecondaryDepartment[jj] <- 'No'
}else{
SecondaryDepartment[jj]<-GetUrlData(urlPath=ii,state_GetDepartmentSecondary)
}
}else{
ECTS[jj]<- NA
CourseType[jj]<- NA
Department[jj]<- NA
SecondaryDepartment[jj]<- NA
}
ECTS[jj] <- gsub(',','.',ECTS[jj])
Department[jj] <- gsub('[\r\n ]',' ',Department[jj])
SecondaryDepartment[jj] <- gsub('[\r\n ]',' ',SecondaryDepartment[jj])
jj<-jj+1
}
library(stringi)
library(RCurl)
library(rlist)
TotalData <- list()
DATA<-list()
for (ii in seq_along(CourseNum[1])){
DATA<-list()
for (jj in seq_along(NumberListCourse[[ii]])){
NameTable <- NumberListCourse[[ii]][jj]
NumberListCourse[[ii]][jj] <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum[ii],'/',NumberListCourse[[ii]][jj],sep='')
NumberListCourse2 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum[ii],'-1/',NameTable,sep='')
NumberListCourse3 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum[ii],'-2/',NameTable,sep='')
if (url.exists(NumberListCourse[[ii]][jj])){
res6<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse[[ii]][jj],state_GetGradeTable),silent=TRUE)
if (inherits(res6,'try-error')){
Grades<-NA
}else{
Grades<-GetUrlData(urlPath=NumberListCourse[[ii]][jj],state_GetGradeTable)
Grades<-gsub('[\r\n ]','',Grades)
}
res7<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse[[ii]][jj],state_Attendants),silent=TRUE)
if (inherits(res7,'try-error')){
Attendants<-NA
}else{
Attendants <- GetUrlData(urlPath=NumberListCourse[[ii]][jj],state_Attendants)
Attendants <- gsub('[\r\n ]','',Attendants)
Attendants <- gsub('\\(.*?\\)', '', Attendants)
Attendants <- gsub(',','.',Attendants)
}
}else if(url.exists(NumberListCourse2)){
res8<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse2,state_GetGradeTable),silent=TRUE)
if (inherits(res8,'try-error')){
Grades<-NA
}else{
Grades<-GetUrlData(urlPath=NumberListCourse2,state_GetGradeTable)
Grades<-gsub('[\r\n ]','',Grades)
}
res9<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse2,state_Attendants),silent=TRUE)
if (inherits(res9,'try-error')){
Attendants<-NA
}else{
Attendants <- GetUrlData(urlPath=NumberListCourse2,state_Attendants)
Attendants <- gsub('[\r\n ]','',Attendants)
Attendants <- gsub('\\(.*?\\)', '', Attendants)
Attendants <- gsub(',','.',Attendants)
}
}else if(url.exists(NumberListCourse3)){
res8<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse3,state_GetGradeTable),silent=TRUE)
if (inherits(res8,'try-error')){
Grades<-NA
}else{
Grades<-GetUrlData(urlPath=NumberListCourse3,state_GetGradeTable)
Grades<-gsub('[\r\n ]','',Grades)
}
res9<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse3,state_Attendants),silent=TRUE)
if (inherits(res9,'try-error')){
Attendants<-NA
}else{
Attendants <- GetUrlData(urlPath=NumberListCourse3,state_Attendants)
Attendants <- gsub('[\r\n ]','',Attendants)
Attendants <- gsub('\\(.*?\\)', '', Attendants)
Attendants <- gsub(',','.',Attendants)
}
}else{
Grades <- NA
Attendants <- NA
}
if (length(Grades)==0){
Grades<-NA
}
if (length(Attendants)==0){
Attendants<-NA
}
if (length(Grades)>8){
Grades <- Grades[1:8]
}
tmp <- list(Grades=as.numeric(Grades),GeneralInfo=as.numeric(Attendants))
DATA[[NameTable]] <- tmp
}
TotalData[[CourseNum[ii]]]<-DATA
}
TotalData
showConnections(all = FALSE)
closeAllConnections()
showConnections(all = FALSE)
TotalData <- list()
DATA<-list()
for (ii in seq_along(CourseNum)){
DATA<-list()
for (jj in seq_along(NumberListCourse[[ii]])){
NameTable <- NumberListCourse[[ii]][jj]
NumberListCourse1 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum[ii],'/',NumberListCourse[[ii]][jj],sep='')
NumberListCourse2 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum[ii],'-1/',NameTable,sep='')
NumberListCourse3 <- paste('http://karakterer.dtu.dk/Histogram/1/',CourseNum[ii],'-2/',NameTable,sep='')
if (url.exists(NumberListCourse1)){
res7<-try(NumberListCourseTemp <- GetUrlData(urlPath=NumberListCourse1,state_Attendants),silent=TRUE)
if (inherits(res7,'try-error')){
Attendants<-NA
}else{
Attendants <- GetUrlData(urlPath=NumberListCourse1,state_Attendants)
Attendants <- gsub('[\r\n ]','',Attendants)
Attendants <- gsub('\\(.*?\\)', '', Attendants)
Attendants <- gsub(',','.',Attendants)
}
}else if(url.exists(NumberListCourse2)){
res9<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse2,state_Attendants),silent=TRUE)
if (inherits(res9,'try-error')){
Attendants<-NA
}else{
Attendants <- GetUrlData(urlPath=NumberListCourse2,state_Attendants)
Attendants <- gsub('[\r\n ]','',Attendants)
Attendants <- gsub('\\(.*?\\)', '', Attendants)
Attendants <- gsub(',','.',Attendants)
}
}else if(url.exists(NumberListCourse3)){
res9<-try(NumberListCourseTemp<-GetUrlData(urlPath=NumberListCourse3,state_Attendants),silent=TRUE)
if (inherits(res9,'try-error')){
Attendants<-NA
}else{
Attendants <- GetUrlData(urlPath=NumberListCourse3,state_Attendants)
Attendants <- gsub('[\r\n ]','',Attendants)
Attendants <- gsub('\\(.*?\\)', '', Attendants)
Attendants <- gsub(',','.',Attendants)
}
}else{
Attendants <- NA
}
if (length(Attendants)==0){
Attendants<-NA
}
tmp <- list(GeneralInfo=as.numeric(Attendants))
DATA[[NameTable]] <- tmp
}
TotalData[[CourseNum[ii]]]<-DATA
closeAllConnections()
}
DATA
length(DATA)
